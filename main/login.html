<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ä°ÅŸitsel EÄŸitim - GiriÅŸ Yap / KayÄ±t Ol</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="container">
      <div class="nav-content">
        <a href="index.html" class="nav-logo">
          <img src="../site-logo.png" alt="Logo">
          Ä°ÅŸitsel EÄŸitim
        </a>
        
        <ul class="nav-links">
          <li><a href="index.html" class="nav-link">Ana Sayfa</a></li>
          <li><a href="leaderboard.html" class="nav-link">Liderlik</a></li>
          <li><a href="achievements.html" class="nav-link">BaÅŸarÄ±mlar</a></li>
        </ul>
        
        <div class="nav-auth">
          <a href="index.html" class="btn btn-secondary">â† Ana Sayfa</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main-content">
    <div class="container">
      <!-- Login Form -->
      <div class="form-container">
        <div class="hero" style="margin-bottom: 2rem;">
          <h1 id="form-title">GiriÅŸ Yap</h1>
          <p id="form-subtitle">HesabÄ±nÄ±za giriÅŸ yaparak oyunlara devam edin</p>
        </div>

        <!-- Alert Messages -->
        <div id="alert-container"></div>

        <!-- Auth Form -->
        <form id="auth-form">
          <div class="form-group">
            <label for="email" class="form-label">E-posta</label>
            <input 
              type="email" 
              id="email" 
              class="form-input" 
              placeholder="ornek@email.com"
              required
            >
          </div>

          <div class="form-group">
            <label for="password" class="form-label">Åifre</label>
            <input 
              type="password" 
              id="password" 
              class="form-input" 
              placeholder="En az 6 karakter"
              required
              minlength="6"
            >
          </div>

          <div class="form-group">
            <button type="submit" id="submit-btn" class="btn btn-primary" style="width: 100%;">
              <span id="btn-text">GiriÅŸ Yap</span>
              <div id="btn-loading" class="spinner" style="display: none; width: 20px; height: 20px;"></div>
            </button>
          </div>
        </form>

        <!-- Google Sign-In Button -->
        <div class="form-group" style="margin-top: 1rem;">
          <button type="button" id="google-signin-btn" class="btn" style="width: 100%; background: #4285f4; color: white; border: none; display: flex; align-items: center; justify-content: center; gap: 12px;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="white"/>
              <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="white"/>
              <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="white"/>
              <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="white"/>
            </svg>
            <span id="google-btn-text">Google ile GiriÅŸ Yap</span>
            <div id="google-btn-loading" class="spinner" style="display: none; width: 16px; height: 16px;"></div>
          </button>
        </div>

        <!-- Divider -->
        <div style="text-align: center; margin: 1.5rem 0; position: relative;">
          <div style="height: 1px; background: var(--border-color); margin: 0 2rem;"></div>
          <span style="position: absolute; top: -8px; left: 50%; transform: translateX(-50%); background: var(--background-primary); padding: 0 1rem; color: var(--text-secondary); font-size: 0.9rem;">veya</span>
        </div>

        <!-- Toggle Form Mode -->
        <div style="text-align: center; margin-top: 1.5rem;">
          <p style="color: var(--text-secondary);">
            <span id="toggle-text">HesabÄ±nÄ±z yok mu?</span>
            <button id="toggle-btn" class="nav-link" style="background: none; border: none; cursor: pointer; font-weight: 600;">
              KayÄ±t Ol
            </button>
          </p>
        </div>
      </div>
    </div>
  </main>

  <!-- Scripts -->
  <script type="module">
    import { loginWithEmail, registerWithEmail, loginWithGoogle, onAuthChange } from './js/auth.js';

    let isLoginMode = true;

    // DOM elements
    const formTitle = document.getElementById('form-title');
    const formSubtitle = document.getElementById('form-subtitle');
    const authForm = document.getElementById('auth-form');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const submitBtn = document.getElementById('submit-btn');
    const btnText = document.getElementById('btn-text');
    const btnLoading = document.getElementById('btn-loading');
    const googleSigninBtn = document.getElementById('google-signin-btn');
    const googleBtnText = document.getElementById('google-btn-text');
    const googleBtnLoading = document.getElementById('google-btn-loading');
    const toggleText = document.getElementById('toggle-text');
    const toggleBtn = document.getElementById('toggle-btn');
    const alertContainer = document.getElementById('alert-container');

    // Check if user is already logged in
    onAuthChange((user) => {
      if (user) {
        // Redirect to home page if already logged in
        window.location.href = 'index.html';
      }
    });

    // Form submit handler
    authForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = emailInput.value.trim();
      const password = passwordInput.value;

      if (!email || !password) {
        showAlert('LÃ¼tfen tÃ¼m alanlarÄ± doldurun.', 'error');
        return;
      }

      setLoading(true);
      clearAlerts();

      try {
        let result;
        if (isLoginMode) {
          result = await loginWithEmail(email, password);
        } else {
          result = await registerWithEmail(email, password);
        }

        if (result.success) {
          showAlert(
            isLoginMode ? 'GiriÅŸ baÅŸarÄ±lÄ±! YÃ¶nlendiriliyorsunuz...' : 'KayÄ±t baÅŸarÄ±lÄ±! YÃ¶nlendiriliyorsunuz...', 
            'success'
          );
          
          // Redirect after short delay
          setTimeout(() => {
            window.location.href = 'index.html';
          }, 1500);
        } else {
          showAlert(result.error, 'error');
        }
      } catch (error) {
        showAlert('Bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.', 'error');
        console.error('Auth error:', error);
      }

      setLoading(false);
    });

    // Google Sign-In handler
    googleSigninBtn.addEventListener('click', async () => {
      setGoogleLoading(true);
      clearAlerts();

      try {
        const result = await loginWithGoogle();
        
        if (result.success) {
          showAlert('Google ile giriÅŸ baÅŸarÄ±lÄ±! YÃ¶nlendiriliyorsunuz...', 'success');
          
          // Redirect after short delay
          setTimeout(() => {
            window.location.href = 'index.html';
          }, 1500);
        } else {
          showAlert(result.error, 'error');
        }
      } catch (error) {
        showAlert('Google ile giriÅŸ yapÄ±lÄ±rken bir hata oluÅŸtu.', 'error');
        console.error('Google signin error:', error);
      }

      setGoogleLoading(false);
    });

    // Toggle between login and register
    toggleBtn.addEventListener('click', () => {
      isLoginMode = !isLoginMode;
      updateFormMode();
      clearAlerts();
      authForm.reset();
    });



    // Show alert message
    function showAlert(message, type) {
      const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
      alertContainer.innerHTML = `
        <div class="alert ${alertClass}">
          ${message}
        </div>
      `;
    }

    // Clear alert messages
    function clearAlerts() {
      alertContainer.innerHTML = '';
    }

    // Set loading state for email/password form
    function setLoading(loading) {
      if (loading) {
        submitBtn.disabled = true;
        btnText.style.display = 'none';
        btnLoading.style.display = 'block';
      } else {
        submitBtn.disabled = false;
        btnText.style.display = 'block';
        btnLoading.style.display = 'none';
      }
    }

    // Set loading state for Google button
    function setGoogleLoading(loading) {
      if (loading) {
        googleSigninBtn.disabled = true;
        googleBtnText.style.display = 'none';
        googleBtnLoading.style.display = 'block';
      } else {
        googleSigninBtn.disabled = false;
        googleBtnText.style.display = 'block';
        googleBtnLoading.style.display = 'none';
      }
    }

    // Update form mode
    function updateFormMode() {
      if (isLoginMode) {
        formTitle.textContent = 'GiriÅŸ Yap';
        formSubtitle.textContent = 'HesabÄ±nÄ±za giriÅŸ yaparak oyunlara devam edin';
        btnText.textContent = 'GiriÅŸ Yap';
        googleBtnText.textContent = 'Google ile GiriÅŸ Yap';
        toggleText.textContent = 'HesabÄ±nÄ±z yok mu?';
        toggleBtn.textContent = 'KayÄ±t Ol';
      } else {
        formTitle.textContent = 'KayÄ±t Ol';
        formSubtitle.textContent = 'Yeni hesap oluÅŸturarak oyunlara baÅŸlayÄ±n';
        btnText.textContent = 'KayÄ±t Ol';
        googleBtnText.textContent = 'Google ile KayÄ±t Ol';
        toggleText.textContent = 'Zaten hesabÄ±nÄ±z var mÄ±?';
        toggleBtn.textContent = 'GiriÅŸ Yap';
      }
    }

    // Check URL parameters for registration mode
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('mode') === 'register') {
      isLoginMode = false;
      updateFormMode();
    }

    // Auto-focus email input
    emailInput.focus();

    console.log('ğŸ” GiriÅŸ sayfasÄ± yÃ¼klendi');
  </script>
</body>
</html> 